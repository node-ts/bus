<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Handlers | @node-ts/bus</title>
    <meta name="description" content="Enterprise message bus library for typescript">
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-139036417-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-139036417-1');
    </script>
    
    <link rel="preload" href="/bus/assets/css/0.styles.a0567244.css" as="style"><link rel="preload" href="/bus/assets/js/app.9b9c970b.js" as="script"><link rel="preload" href="/bus/assets/js/2.40db6fc8.js" as="script"><link rel="preload" href="/bus/assets/js/10.da946e8a.js" as="script"><link rel="prefetch" href="/bus/assets/js/11.f7b4aa18.js"><link rel="prefetch" href="/bus/assets/js/12.aa407c4a.js"><link rel="prefetch" href="/bus/assets/js/13.36afd7f4.js"><link rel="prefetch" href="/bus/assets/js/14.44c52693.js"><link rel="prefetch" href="/bus/assets/js/15.18967a22.js"><link rel="prefetch" href="/bus/assets/js/16.d53fa3bb.js"><link rel="prefetch" href="/bus/assets/js/17.456ac79b.js"><link rel="prefetch" href="/bus/assets/js/18.fb92a928.js"><link rel="prefetch" href="/bus/assets/js/19.39fc7cc9.js"><link rel="prefetch" href="/bus/assets/js/20.1674d02d.js"><link rel="prefetch" href="/bus/assets/js/21.b2f3dc85.js"><link rel="prefetch" href="/bus/assets/js/22.153c6055.js"><link rel="prefetch" href="/bus/assets/js/23.5cd90b86.js"><link rel="prefetch" href="/bus/assets/js/24.930648bb.js"><link rel="prefetch" href="/bus/assets/js/25.2f9a4e57.js"><link rel="prefetch" href="/bus/assets/js/26.0b3967e8.js"><link rel="prefetch" href="/bus/assets/js/27.6d0990f4.js"><link rel="prefetch" href="/bus/assets/js/28.fe213cf5.js"><link rel="prefetch" href="/bus/assets/js/29.c9a1d805.js"><link rel="prefetch" href="/bus/assets/js/3.ad62bd45.js"><link rel="prefetch" href="/bus/assets/js/30.d658eac0.js"><link rel="prefetch" href="/bus/assets/js/31.ee0536bc.js"><link rel="prefetch" href="/bus/assets/js/32.67be88d4.js"><link rel="prefetch" href="/bus/assets/js/33.ec397c9a.js"><link rel="prefetch" href="/bus/assets/js/34.16465bea.js"><link rel="prefetch" href="/bus/assets/js/35.5f7522c2.js"><link rel="prefetch" href="/bus/assets/js/36.fc380b80.js"><link rel="prefetch" href="/bus/assets/js/37.0a8285aa.js"><link rel="prefetch" href="/bus/assets/js/38.0467eb59.js"><link rel="prefetch" href="/bus/assets/js/39.4cb19319.js"><link rel="prefetch" href="/bus/assets/js/4.14653418.js"><link rel="prefetch" href="/bus/assets/js/40.304ab5a1.js"><link rel="prefetch" href="/bus/assets/js/41.69b46a27.js"><link rel="prefetch" href="/bus/assets/js/42.39ba8e37.js"><link rel="prefetch" href="/bus/assets/js/43.9085c1f3.js"><link rel="prefetch" href="/bus/assets/js/44.be17aea7.js"><link rel="prefetch" href="/bus/assets/js/45.204a2c48.js"><link rel="prefetch" href="/bus/assets/js/5.13b1a726.js"><link rel="prefetch" href="/bus/assets/js/6.a563d3f5.js"><link rel="prefetch" href="/bus/assets/js/7.074f2c3e.js"><link rel="prefetch" href="/bus/assets/js/8.397fdcaa.js"><link rel="prefetch" href="/bus/assets/js/9.52cf5dbe.js">
    <link rel="stylesheet" href="/bus/assets/css/0.styles.a0567244.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bus/" class="home-link router-link-active"><!----> <span class="site-name">@node-ts/bus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bus/" class="nav-link">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link router-link-exact-active router-link-active">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bus/" class="nav-link">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link router-link-exact-active router-link-active">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bus/" class="sidebar-link">Home</a></li><li><a href="/bus/packages/bus-messages/" class="sidebar-link">Messages</a></li><li><a href="/bus/packages/bus-core/src/handler/" class="active sidebar-link">Handlers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#consuming-messages" class="sidebar-link">Consuming messages</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#receiving-message-options-attributes-and-metadata" class="sidebar-link">Receiving message options, attributes and metadata</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#system-and-non-domain-messages" class="sidebar-link">System and non-domain messages</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#messages-that-fail-processing" class="sidebar-link">Messages that fail processing</a></li><li class="sidebar-sub-header"><a href="/bus/packages/bus-core/src/handler/#long-running-processes" class="sidebar-link">Long Running Processes</a></li></ul></li><li><a href="/bus/packages/bus-core/src/transport/" class="sidebar-link">Transports</a></li><li><a href="/bus/packages/bus-workflow/" class="sidebar-link">Workflows</a></li><li><a href="/bus/packages/bus-workflow/src/workflow/persistence/" class="sidebar-link">Persistence</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="handlers"><a href="#handlers" aria-hidden="true" class="header-anchor">#</a> Handlers</h1> <br> <p><strong>üî• v0.x of @node-ts/bus is deprecated. For the latest version visit <a href="https://node-ts.gitbook.io/bus/" target="_blank" rel="noopener noreferrer">https://node-ts.gitbook.io/bus/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> üî•</strong></p> <br> <hr> <p>Message handlers are stateless functions that receive messages and perform an action. Once this action has completed, the message is considered processed and is removed from the underlying transport.</p> <p>If an error is thrown during the processing of the message, then the message is placed back onto the queue so that it can again be handled and the action retried.</p> <h2 id="implementation"><a href="#implementation" aria-hidden="true" class="header-anchor">#</a> Implementation</h2> <p>Each message handler is a new class definition. Handlers can receive any type of message from <code>@node-ts/bus-messages</code>, ie: <code>Command</code>, <code>Event</code>, or <code>Message</code>.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// send-welcome-email-handler.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HandlesMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SendWelcomeEmail <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'contracts'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'inversify'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ACCOUNT_SYMBOLS</span><span class="token punctuation">,</span> EmailService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'domain'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">LOGGER_SYMBOLS</span><span class="token punctuation">,</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/logger-core'</span>

@<span class="token function">HandlesMessage</span><span class="token punctuation">(</span>SendWelcomeEmail<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GenerateTranscriptHandler</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token constant">ACCOUNT_SYMBOLS</span><span class="token punctuation">.</span>EmailService<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> emailService<span class="token punctuation">:</span> EmailService</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>command<span class="token punctuation">:</span> SendWelcomeEmail<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>emailService<span class="token punctuation">.</span><span class="token function">sendWelcomeEmail</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>The next step is to register the handler with the <code>ApplicationBootstrap</code> so that the underlying transport can be configured and subscribed to the various topics:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// application-container.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> ApplicationBootstrap<span class="token punctuation">,</span> <span class="token constant">BUS_SYMBOLS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Container<span class="token punctuation">,</span> ContainerModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'inversify'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GenerateTranscriptHandler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./generate-transcript-handler'</span>

<span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
container<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">BusModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bootstrap <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span>ApplicationBootstrap<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token constant">BUS_SYMBOLS</span><span class="token punctuation">.</span>ApplicationBootstrap<span class="token punctuation">)</span>
bootstrap<span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span>GenerateTranscriptHandler<span class="token punctuation">)</span>

bootstrap<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>
</code></pre></div><h2 id="consuming-messages"><a href="#consuming-messages" aria-hidden="true" class="header-anchor">#</a> Consuming messages</h2> <p>Messages read from the underlying transport aren't immediately removed. Instead, a read lock or visibility flag is placed on the message at the transport so that it won't be read by other consumers. These flags are designed to be relatively short lived, around 30 seconds or so, as the handler is expected to process the message quickly so that the message can be removed.</p> <h2 id="receiving-message-options-attributes-and-metadata"><a href="#receiving-message-options-attributes-and-metadata" aria-hidden="true" class="header-anchor">#</a> Receiving message options, attributes and metadata</h2> <p>Additional metadata can be sent along with messages that don't belong to the message body, but is instead added to the message headers or attributes as metadata. This is sent to messages handlers as a second, optional parameter. For example:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>
    _<span class="token punctuation">:</span> Command<span class="token punctuation">,</span>
    messageOptions<span class="token punctuation">:</span> MessageAttributes<span class="token operator">&lt;</span><span class="token punctuation">{</span> userId<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Example consuming message headers'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> userId<span class="token punctuation">:</span> messageOptions<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>userId <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="system-and-non-domain-messages"><a href="#system-and-non-domain-messages" aria-hidden="true" class="header-anchor">#</a> System and non-domain messages</h2> <p>Sometimes you want to subscribe your application to messages that it doesn't own or publish. This is common when integrating with external systems that publish messages that don't conform to the structure of those defined in <code>@node-ts/bus-messages</code>. In order to subscribe to and handle these types of messages, you need to provide a resolver and a topic identifier as part of your handler declaration.</p> <p>For example, let's say we're working with AWS and want to be notified every time there's a new S3 object created in a bucket. S3 publishes these events to an existing SNS topic, and we want to subscribe our application SQS queue to it and handle these messages. The handler declaration would look like this:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> S3Event <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'aws-lambda'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HandlesMessage<span class="token punctuation">,</span> Handler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>

@<span class="token function">HandlesMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">:</span> S3Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// At runtime, `event` may or may not be an S3Event so we need to assert</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>Records<span class="token punctuation">)</span> <span class="token operator">||</span> event<span class="token punctuation">.</span>Records<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Likewise we could get different types of S3Events (eg: deletions)</span>
    <span class="token keyword">return</span> event<span class="token punctuation">.</span>Records<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>eventsAreS3PutEvents<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'arn:aws:sns:us-east-1:000000000000:s3-object-created'</span> <span class="token comment">// ARN that identifies the topic to subscribe to</span>
<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LogS3ObjectCreatedEventHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Handler</span><span class="token operator">&lt;</span>S3Event<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span>event<span class="token punctuation">:</span> S3Event<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> 
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'New S3 object created'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> eventsAreS3PutEvents <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> S3EventRecord<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">boolean</span></span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>eventName <span class="token operator">===</span> <span class="token string">'ObjectCreated:Put'</span>
</code></pre></div><p>When this handler is registered, it will automatically subscribe the application queue to the underlying topic. Note that the topic identifier is specific to the bus transport being used. Here <code>@node-ts/bus-sqs</code> is used so an SNS ARN is provided, but if you were using a different transport (eg: RabbitMQ) then you would provide a different identifier (eg: an Exchange name).</p> <p>All messages received from the queue will be sent to the resolver. Due to the prototype/duck typing nature of Javascript, you'll need to place assertions into the resolver so that your handler only receives messages you are intending to handle.</p> <h2 id="messages-that-fail-processing"><a href="#messages-that-fail-processing" aria-hidden="true" class="header-anchor">#</a> Messages that fail processing</h2> <p>When a message handling function throws an error while processing a message, the message is returned to the queue to be retried. Often the message will succeed on a subsequent retry depending on the reason for the error (eg: a core piece of infrastructure was down, an external service was unavailable, a network partition event occurred, a row lock version conflict stopped an update going through).</p> <p>There are instances when a message is considered <code>poisoned</code> and will never process successfully regardless of the number of retry attempts. Such situations occur because of bugs, manual modification of database rows, etc. After the message has been retried a number of times (generally 10 attempts), then the message will be forwarded to the dead letter queue.</p> <h2 id="long-running-processes"><a href="#long-running-processes" aria-hidden="true" class="header-anchor">#</a> Long Running Processes</h2> <p>There are occasions where messages need to perform a long running process such as backing up a database or encoding a video. Because these processes can go well beyond the 30 second handling window, they can't be processed the normal way.</p> <p>Instead, the action of the message handling function should be to start the process running. This could be a docker container, cloud service task, remote process etc. Once that process completes then it should emit an event reporting the completion of the process.</p> <p>This then treats the process as asynchronous. Ie: an event is raised when the process starts, and another to report that the process has completed.</p> <p>For more information on coordinating long running processes and higher-order logic, see <a href="/bus/packages/bus-workflow/">@node-ts/bus-workflows</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/bus/packages/bus-messages/" class="prev">Messages</a></span> <span class="next"><a href="/bus/packages/bus-core/src/transport/">Transports</a>‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/bus/assets/js/app.9b9c970b.js" defer></script><script src="/bus/assets/js/2.40db6fc8.js" defer></script><script src="/bus/assets/js/10.da946e8a.js" defer></script>
  </body>
</html>
